# Generated by ip6tables-save v1.4.21 on {{ ansible_date_time['date'] }}
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:sshguard - [0:0]
:TCP - [0:0]
:UDP - [0:0]
:UDP-FORWARD - [0:0]
:TCP-FORWARD - [0:0]
-A INPUT -m rt --rt-type 0 --rt-segsleft 0 -j DROP
-A FORWARD -m rt --rt-type 0 --rt-segsleft 0 -j DROP
-A INPUT -j sshguard
-A FORWARD -j sshguard
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A FORWARD -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate INVALID -j DROP
-A FORWARD -m conntrack --ctstate INVALID -j DROP
-A INPUT -d ff00::/8 -j ACCEPT
-A FORWARD -d ff00::/8 -j ACCEPT
-A INPUT -s fe80::/10 -j ACCEPT
-A FORWARD -s fe80::/10 -j ACCEPT
{% if 'ALLOW-IPV6' in iptables %}
{% for d in iptables['ALLOW-IPV6'] %}
-A INPUT -s {{ d }} -j ACCEPT
-A FORWARD -s {{ d }} -j ACCEPT
{% endfor %}
{% endif %}
-A INPUT -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m conntrack --ctstate NEW -j ACCEPT
-A FORWARD -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m conntrack --ctstate NEW -j ACCEPT
-A INPUT -p udp -m conntrack --ctstate NEW -j UDP
-A FORWARD -p udp -m conntrack --ctstate NEW -j UDP-FORWARD
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j TCP
-A FORWARD -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j TCP-FORWARD
-A INPUT -p udp -j REJECT --reject-with icmp6-port-unreachable
-A FORWARD -p udp -j REJECT --reject-with icmp6-port-unreachable
-A INPUT -p tcp -j REJECT --reject-with tcp-reset
-A FORWARD -p tcp -j REJECT --reject-with tcp-reset
-A INPUT -j REJECT --reject-with icmp6-port-unreachable
-A FORWARD -j REJECT --reject-with icmp6-port-unreachable
{% if 'TCP' in iptables %}
{% for d in iptables['TCP'] %}
-A TCP -p tcp -m tcp {% if 'ip6_src' in d %}-s {{ d.ip6_src }}{% endif %} {% if 'ip6_dst' in d %}-d {{ d.ip6_dst }}{% endif %} {% if 'iface_src' in d %}-i {{ d.iface_src }}{% endif %} {% if 'iface_dst' in d %}-o {{ d.iface_dst }}{% endif %} {% if 'port_src' in d %}--sport {{ d.port_src }}{% endif %} {% if 'port_dst' in d %}--dport {{ d.port_dst }}{% endif %} -j ACCEPT
{% endfor %}
{% endif %}

{% if 'UDP' in iptables %}
{% for d in iptables['UDP'] %}
-A UDP -p udp -m udp {% if 'ip6_src' in d %}-s {{ d.ip6_src }}{% endif %} {% if 'ip6_dst' in d %}-d {{ d.ip6_dst }}{% endif %} {% if 'iface_src' in d %}-i {{ d.iface_src }}{% endif %} {% if 'iface_dst' in d %}-o {{ d.iface_dst }}{% endif %} {% if 'port_src' in d %}--sport {{ d.port_src }}{% endif %} {% if 'port_dst' in d %}--dport {{ d.port_dst }}{% endif %} -j ACCEPT
{% endfor %}
{% endif %}

{% if 'TCP_FORWARD' in iptables %}
{% for d in iptables['TCP_FORWARD'] %}
-A TCP-FORWARD -p tcp -m tcp {% if 'ip6_src' in d %}-s {{ d.ip6_src }}{% endif %} {% if 'ip6_dst' in d %}-d {{ d.ip6_dst }}{% endif %} {% if 'iface_src' in d %}-i {{ d.iface_src }}{% endif %} {% if 'iface_dst' in d %}-o {{ d.iface_dst }}{% endif %} {% if 'port_src' in d %}--sport {{ d.port_src }}{% endif %} {% if 'port_dst' in d %}--dport {{ d.port_dst }}{% endif %} -j ACCEPT
{% endfor %}
{% endif %}

{% if 'UDP_FORWARD' in iptables %}
{% for d in iptables['UDP_FORWARD'] %}
-A UDP-FORWARD -p udp -m udp {% if 'ip6_src' in d %}-s {{ d.ip6_src }}{% endif %} {% if 'ip6_dst' in d %}-d {{ d.ip6_dst }}{% endif %} {% if 'iface_src' in d %}-i {{ d.iface_src }}{% endif %} {% if 'iface_dst' in d %}-o {{ d.iface_dst }}{% endif %} {% if 'port_src' in d %}--sport {{ d.port_src }}{% endif %} {% if 'port_dst' in d %}--dport {{ d.port_dst }}{% endif %} -j ACCEPT
{% endfor %}
{% endif %}
COMMIT
# Completed on {{ ansible_date_time['date'] }}
