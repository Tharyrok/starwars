---

- hosts: r2-d2.tharyrok.eu.org

  pre_tasks:
    - include_vars: ../secured/password.yml
  vars:
    iptables:
      IPV4-FORWARD: true
      IP-WAN: "62.210.100.21"
      TCP: [ 22, 655 ]
      UDP: [ 655 ]
      TCP_IP:
       - { port: 53, cidr: "192.168.70.0/24"}
      UDP_IP:
       - { port: 53, cidr: "192.168.70.0/24"}
      TCP_FORWARD_4:
       - { port: 53, ip: "192.168.70.5", from: "108.61.224.67/32"}
       - { port: 53, ip: "192.168.70.5", from: "173.244.206.25/32"}
       - { port: 53, ip: "192.168.70.5", from: "173.244.206.26/32"}
       - { port: 53, ip: "192.168.70.5", from: "88.198.106.11/32"}
       - { port: 53, ip: "192.168.70.5", from: "78.46.95.154/32"}

       - { port: 25, ip: "192.168.70.10"}
       - { port: 587, ip: "192.168.70.10"}
       - { port: 465, ip: "192.168.70.10"}
       - { port: 143, ip: "192.168.70.10"}
       - { port: 993, ip: "192.168.70.10"}
       - { port: 4190, ip: "192.168.70.10"}

       - { port: 80, ip: "192.168.70.20"}
       - { port: 443, ip: "192.168.70.20"}
       - { port: 2222, ip: "192.168.70.20"}

       - { port: 25565, ip: "192.168.70.25"}
       - { port: 25512, ip: "192.168.70.25"}

       - { port: 32400, ip: "192.168.70.30"}
       - { port: 4949, ip: "192.168.70.30"}

       - { port: 51413, ip: "192.168.70.35"}
       - { port: 3000, ip: "192.168.70.35"}
       - { port: 137, ip: "192.168.70.35"}
       - { port: 138, ip: "192.168.70.35"}
       - { port: 139, ip: "192.168.70.35"}
       - { port: 445, ip: "192.168.70.35"}

       - { port: 5222, ip: "192.168.70.45"}
       - { port: 5322, ip: "192.168.70.45"}
       - { port: 4949, ip: "192.168.70.45"}


      UDP_FORWARD_4:
       - { port: 53, ip: "192.168.70.5", from: "108.61.224.67/32"}
       - { port: 53, ip: "192.168.70.5", from: "173.244.206.25/32"}
       - { port: 53, ip: "192.168.70.5", from: "173.244.206.26/32"}
       - { port: 53, ip: "192.168.70.5", from: "88.198.106.11/32"}
       - { port: 53, ip: "192.168.70.5", from: "78.46.95.154/32"}

       - { port: 25565, ip: "192.168.70.25"}
       - { port: 25512, ip: "192.168.70.25"}

       - { port: 32400, ip: "192.168.70.30"}

       - { port: 51413, ip: "192.168.70.35"}

       - { port: 5222, ip: "192.168.70.45"}
       - { port: 5322, ip: "192.168.70.45"}

      TCP_FPREROUTING_4:
       - { in: 53, out: 53, ip: "192.168.70.5", interface: "eth0" }
       - { in: 53, out: 53, ip: "192.168.70.5", interface: "br-lan" }
       - { in: 53, out: 53, ip: "192.168.70.5", interface: "tharyrok" }

       - { in: 25, out: 25, ip: "192.168.70.10", interface: "eth0" }
       - { in: 25, out: 25, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 25, out: 25, ip: "192.168.70.10", interface: "tharyrok" }
       - { in: 587, out: 587, ip: "192.168.70.10", interface: "eth0" }
       - { in: 587, out: 587, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 587, out: 587, ip: "192.168.70.10", interface: "tharyrok" }
       - { in: 465, out: 465, ip: "192.168.70.10", interface: "eth0" }
       - { in: 465, out: 465, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 465, out: 465, ip: "192.168.70.10", interface: "tharyrok" }
       - { in: 143, out: 143, ip: "192.168.70.10", interface: "eth0" }
       - { in: 143, out: 143, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 143, out: 143, ip: "192.168.70.10", interface: "tharyrok" }
       - { in: 993, out: 993, ip: "192.168.70.10", interface: "eth0" }
       - { in: 993, out: 993, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 993, out: 993, ip: "192.168.70.10", interface: "tharyrok" }
       - { in: 4190, out: 4190, ip: "192.168.70.10", interface: "eth0" }
       - { in: 4190, out: 4190, ip: "192.168.70.10", interface: "br-lan" }
       - { in: 4190, out: 4190, ip: "192.168.70.10", interface: "tharyrok" }

       - { in: 80, out: 80, ip: "192.168.70.20", interface: "eth0" }
       - { in: 80, out: 80, ip: "192.168.70.20", interface: "br-lan" }
       - { in: 80, out: 80, ip: "192.168.70.20", interface: "tharyrok" }
       - { in: 443, out: 443, ip: "192.168.70.20", interface: "eth0" }
       - { in: 443, out: 443, ip: "192.168.70.20", interface: "br-lan" }
       - { in: 443, out: 443, ip: "192.168.70.20", interface: "tharyrok" }
       - { in: 2222, out: 2222, ip: "192.168.70.20", interface: "eth0" }
       - { in: 2222, out: 2222, ip: "192.168.70.20", interface: "br-lan" }
       - { in: 2222, out: 2222, ip: "192.168.70.20", interface: "tharyrok" }

       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "eth0" }
       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "br-lan" }
       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "tharyrok" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "eth0" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "br-lan" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "tharyrok" }

       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "eth0" }
       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "br-lan" }
       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "tharyrok" }

       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "eth0" }
       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "br-lan" }
       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "tharyrok" }
       - { in: 3000, out: 3000, ip: "192.168.70.35", interface: "tharyrok" }
       - { in: 137, out: 137, ip: "192.168.70.35", interface: "tharyrok" }
       - { in: 138, out: 138, ip: "192.168.70.35", interface: "tharyrok" }
       - { in: 139, out: 139, ip: "192.168.70.35", interface: "tharyrok" }
       - { in: 445, out: 445, ip: "192.168.70.35", interface: "tharyrok" }

       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "eth0" }
       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "br-lan" }
       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "tharyrok" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "eth0" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "br-lan" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "tharyrok" }
      UDP_PREROUTING_4:
       - { in: 53, out: 53, ip: "192.168.70.5", interface: "eth0" }
       - { in: 53, out: 53, ip: "192.168.70.5", interface: "tharyrok" }

       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "eth0" }
       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "br-lan" }
       - { in: 25565, out: 25565, ip: "192.168.70.25", interface: "tharyrok" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "eth0" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "br-lan" }
       - { in: 25512, out: 25512, ip: "192.168.70.25", interface: "tharyrok" }

       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "eth0" }
       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "br-lan" }
       - { in: 32400, out: 32400, ip: "192.168.70.30", interface: "tharyrok" }

       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "eth0" }
       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "br-lan" }
       - { in: 51413, out: 51413, ip: "192.168.70.35", interface: "tharyrok" }

       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "eth0" }
       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "br-lan" }
       - { in: 5222, out: 5222, ip: "192.168.70.45", interface: "tharyrok" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "eth0" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "br-lan" }
       - { in: 5322, out: 5322, ip: "192.168.70.45", interface: "tharyrok" }

      MASQUERADE:
       - { interface: "eth0", cidr: "192.168.70.0/24"}

  roles:
    - iptables
    - unbound
