---

- hosts: r2-d2.tharyrok.eu.org

  pre_tasks:
    - include_vars: ../secured/password.yml
  vars:
    unbound_conf:
      interface:
        - "192.168.70.1"
        - "127.0.0.1"
        - "::1"
      access:
        - "127.0.0.1"
        - "::1"
        - "192.168.70.0/24"
    iptables:
      IPV4_FORWARD: true
      IP4_WAN: "62.210.100.21"
      FORWARD_4:
        - {iface_src: "br-lan", iface_dst: "eth0"}
        - {iface_src: "br-lan", iface_dst: "tharyrok"}

      TCP:
        - { port_dst: 22 }
        - { port_dst: 655 }
        - { port_dst: 53, ip4_src: "192.168.70.0/24"}

      UDP:
        - { port_dst: 655 }
        - { port_dst: 53, ip4_src: "192.168.70.0/24"}

      TCP_FORWARD:
       - { port_dst: 53, ip4_dst: "192.168.70.5"}

       - { port_dst: 25, ip4_dst: "192.168.70.10"}
       - { port_dst: 587, ip4_dst: "192.168.70.10"}
       - { port_dst: 465, ip4_dst: "192.168.70.10"}
       - { port_dst: 143, ip4_dst: "192.168.70.10"}
       - { port_dst: 993, ip4_dst: "192.168.70.10"}
       - { port_dst: 4190, ip4_dst: "192.168.70.10"}
       - { port_dst: 80, ip4_dst: "192.168.70.10", ip4_src: "192.168.70.20", ip4_nat: "192.168.70.10"}

       - { port_dst: 3306, ip4_dst: "192.168.70.15", ip4_src: "192.168.70.20", ip4_nat: "192.168.70.15"}
       - { port_dst: 3306, ip4_dst: "192.168.70.15", ip4_src: "192.168.70.10", ip4_nat: "192.168.70.15"}
       - { port_dst: 3306, ip4_dst: "192.168.70.15", ip4_src: "192.168.70.35", ip4_nat: "192.168.70.35"}

       - { port_dst: 80, ip4_dst: "192.168.70.20"}
       - { port_dst: 443, ip4_dst: "192.168.70.20"}
       - { port_dst: 2222, ip4_dst: "192.168.70.20"}

       - { port_dst: 25565, ip4_dst: "192.168.70.25"}
       - { port_dst: 25512, ip4_dst: "192.168.70.25"}

       - { port_dst: 32400, ip4_dst: "192.168.70.30"}
       - { port_dst: 4949, ip4_dst: "192.168.70.30"}

       - { port_dst: 80, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.20", ip4_nat: "192.168.70.35"}
       - { port_dst: 2224, ip4_dst: "192.168.70.35"}
       - { port_dst: 51413, ip4_dst: "192.168.70.35"}
       - { port_dst: 51414, ip4_dst: "192.168.70.35"}
       - { port_dst: 6881, ip4_dst: "192.168.70.35"}
       - { port_dst: 6882, ip4_dst: "192.168.70.35"}

       - { port_dst: 111, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 2049, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32764, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32765, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32766, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32767, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32768, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32769, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 139, ip4_dst: "192.168.70.35", ip4_src: "192.168.42.0/24", ip4_nat: "192.168.70.35"}
       - { port_dst: 445, ip4_dst: "192.168.70.35", ip4_src: "192.168.42.0/24", ip4_nat: "192.168.70.35"}


       - { port_dst: 5222, ip4_dst: "192.168.70.45"}
       - { port_dst: 5322, ip4_dst: "192.168.70.45"}
       - { port_dst: 4949, ip4_dst: "192.168.70.45"}


      UDP_FORWARD:
       - { port_dst: 53, ip4_dst: "192.168.70.5"}

       - { port_dst: 25565, ip4_dst: "192.168.70.25"}
       - { port_dst: 25512, ip4_dst: "192.168.70.25"}

       - { port_dst: 32400, ip4_dst: "192.168.70.30"}

       - { port_dst: 51413, ip4_dst: "192.168.70.35"}
       - { port_dst: 51414, ip4_dst: "192.168.70.35"}
       - { port_dst: 6881, ip4_dst: "192.168.70.35"}
       - { port_dst: 6882, ip4_dst: "192.168.70.35"}

       - { port_dst: 111, ip4_dst: "192.168.70.35", v: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 2049, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32764, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32765, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32766, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32767, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32768, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 32769, ip4_dst: "192.168.70.35", ip4_src: "192.168.70.30", ip4_nat: "192.168.70.35"}
       - { port_dst: 137, ip4_dst: "192.168.70.35", ip4_src: "192.168.42.0/24", ip4_nat: "192.168.70.35"}
       - { port_dst: 138, ip4_dst: "192.168.70.35", ip4_src: "192.168.42.0/24", ip4_nat: "192.168.70.35"}

       - { port_dst: 5222, ip4_dst: "192.168.70.45"}
       - { port_dst: 5322, ip4_dst: "192.168.70.45"}

      MASQUERADE:
       - { iface_dst: "eth0", ip4_src: "192.168.70.0/24"}

  roles:
    - iptables
    - unbound
